{{ define "page-head" }}

{{- $firebaseInit := "/__/firebase/init.js" -}}
{{- $configPath := "chat/js/config.js" -}}

{{- if eq hugo.Environment "development" -}}
    {{- $firebaseInit = "/__/firebase/init.js?useEmulator=true" -}}
    {{- $configPath = "chat/js/config-dev.js" -}}
{{- end -}}

<!-- Firebase -->
<script src="/__/firebase/8.2.6/firebase-app.js" defer></script>
<script src="/__/firebase/8.2.6/firebase-firestore.js" defer></script>
<script src="{{ $firebaseInit }}" defer></script>

<!-- WebRTC Adapter -->
<script src="{{ `chat/js/adapter.js` | relURL }}" defer></script>

<link rel="stylesheet" href="{{ `chat/css/styles.css` | relURL }}">

{{ $config := resources.Get $configPath -}}
<script src="{{ $config.RelPermalink }}" defer></script>

{{ $script := resources.Get "chat/js/chat.js" | js.Build "chat/js/chat.js" }}
<script src="{{ $script.RelPermalink }}" defer></script>
{{ end }}

{{ define "nav" }}
<nav class="navbar chat-nav">
    <a href="{{ `` | relURL }}" class="navbar-brand">
        <img src="{{ `img/pearrd-logo.svg` | relURL }}" alt="Pearrd logo" width="50" height="50">
        Pearrd
    </a>

    <!-- Room ID -->
    <form class="form-inline">
        <div class="input-group">
            <div class="input-group-prepend">
                <span class="input-group-text">Room ID</span>
            </div>
            <input id="room-id-input" class="form-control" type="text" placeholder="Joinable Room ID">
            <div class="input-group-append">
                <a id="share-id-btn" class="btn btn-primary" href="#share-modal">Share</a>
            </div>
        </div>
    </form>

    <!-- User Info -->
    <div class="navbar-content">
        <a id="user-avatar" class="btn btn-square btn-primary rounded-circle" href="#username-modal">UN</a>
    </div>
</nav>
{{ end }}

{{ define "modals" }}
<!-- Share Modal -->
<div id="share-modal" class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <a href="#" class="close" role="button" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </a>

            <h5 id="share-room-id" class="modal-title">Room ID</h5>
            <section>
                <button id="share-gmail" class="btn btn-link">share with Gmail</button>
                <button id="share-default" class="btn btn-link">share with default</button>
                <button id="share-copy-link" class="btn btn-link">copy link</button>
                <button id="share-copy" class="btn btn-link">copy</button>
            </section>
        </div>
    </div>
</div>

<!-- Create Username Modal -->
<div id="username-modal" class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <a href="#" class="close" role="button" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </a>

            <h5 class="modal-title">Create a username</h5>
            <p>Create a temporary username for this chat.</p>
            <section>
                <input class="form-control" type="text" id="username" placeholder="username" 
                    autocomplete="off">
                <p class="form-input-hint"></p>
                <button id="create-username" class="btn btn-primary" disabled>Create</button>
            </section>
        </div>
    </div>
</div>

<!-- Input Device Modal -->
<div id="input-device-modal" class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <a href="#" class="close" role="button" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </a>

            <h5 class="modal-title">Input Devices</h5>
            <form id="input-device-options">
                <div class="form-group">
                    <label for="video-device">Video</label>
                    <select id="video-device" class="form-control" name="video-device">
                        <option>Auto</option>
                        <option>Off</option>
                        <option>Default</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="audio-device">Audio</label>
                    <select id="audio-device" class="form-control" name="audio-device">
                        <option>Auto</option>
                        <option>Off</option>
                        <option>Default</option>
                    </select>
                </div>
            </form>
        </div>
    </div>
</div>
{{ end }}

{{ define "main-content" }}
<div id="chat-opts" class="container">
    <!-- Room Actions -->
    <section id="room-actions">
        <button id="create-room" class="btn btn-primary">Create Room</button>
        <button id="join-room" class="btn btn-primary">Join Room</button>
        <button id="hang-up" class="btn btn-primary" disabled>Hang up</button>
    </section>

    <!-- Stream Options -->
    <form id="stream-options" class="form-inline">
        <div class="custom-switch">
            <input type="checkbox" id="audio-enabled" name="audio-enabled">
            <label for="audio-enabled">Audio</label>
        </div>
        <div class="custom-switch">
            <input type="checkbox" id="video-enabled" name="video-enabled">
            <label for="video-enabled">Video</label>
        </div>
        <div class="custom-switch">
            <input type="checkbox" id="screen-share-enabled" name="screen-share-enabled">
            <label for="screen-share-enabled">Screen Share</label>
        </div>

        <a id="more-options" class="btn" href="#input-device-modal">Options</a>
    </form>
</div>

<!-- Communication Area -->
<section id="comm-area">
    <!-- Stream(s) -->
    <div id="stream-area"></div>

    <!-- Video template -->
    <template id="template-video">
        <div class="video-container">
            <div class="stream-user">Username</div>
            <video autoplay playsinline controls></video>
        </div>
    </template>

    <!-- Chat -->
    <div id="chat-area">
        <div id="messages-container"></div>
        <textarea id="message-input" class="form-control" name="message" placeholder="Message"></textarea>
        <div id="send-area">
            <small class="text-primary">Shortcut: Ctrl+Enter</small>
            <button id="send" class="btn btn-primary" disabled>Send</button>
        </div>
    </div>

    <!-- Message templates -->
    <template id="template-msg">
        <div class="message">
            <p class="msg-username text-primary text-tiny">Username</p>
            <p class="msg-content">Message content</p>
        </div>
    </template>
    <template id="template-msg-self">
        <div class="message msg-self">
            <p class="msg-username text-primary text-tiny">Username</p>
            <p class="msg-content">Message content</p>
        </div>
    </template>
    <template id="template-msg-info">
        <div class="message msg-info">
            <p class="msg-content text-tiny text-center text-muted">Message content</p>
        </div>
    </template>
</section>

<!-- Help Info -->
<section id="help-area">
    <details>
        <summary>Help</summary>
        <h5>Sharing the room</h5>
        <p>Click the Share button to email the room link or copy the room id.</p>
    
        <h5>Room size limit</h5>
        <p>Each room supports up to 4 participants. This may change in the future.</p>
    
        <h5>Selecting Video &amp; Audio input</h5>
        <p>Select the Video and Audio input devices by clicking the Options button.</p>
    </details>
</section>
{{ end }}