window.addEventListener("load",()=>{window.jsPDF=window.jspdf.jsPDF,document.getElementById("overlay-spinner").remove();let e=new fabric.Canvas(document.querySelector("canvas"),{isDrawingMode:!0,enableRetinaScaling:!0}),t=window.innerWidth,n=3e3;var l=void 0,a=!1;function d(){e.setDimensions({width:window.innerWidth,height:n})}window.innerWidth<1e3&&(n=1500),e.setDimensions({width:t,height:n}),e.isDrawingMode=!0,e.freeDrawingBrush.width=3,e.freeDrawingBrush.color="#303030f1",e.allowTouchScrolling="true",l="draw",e.selection=!0,window.addEventListener("resize",d);let r=()=>{e.setBackgroundColor({source:"grid.jpg"},e.renderAll.bind(e))},i=document.querySelector(".collapse-btn"),o=document.querySelector(".header");function s(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],l=atob(t[1]),a=l.length,d=new Uint8Array(a);a--;)d[a]=l.charCodeAt(a);return new Blob([d],{type:n})}i.addEventListener("click",()=>{f("hide"),i.classList.toggle("collapsed"),o.classList.toggle("header-collapsed"),console.log("clicked")});let c=document.getElementById("save-img"),g=document.getElementById("save-pdf");c.addEventListener("click",()=>{let e=document.getElementById("modal-bg");e.classList.remove("modal-active"),m(),r(),setTimeout(u,1e3)}),g.addEventListener("click",()=>{let e=document.getElementById("modal-bg");e.classList.remove("modal-active"),m(),r(),setTimeout(E,1e3)});let m=()=>{let e=document.getElementById("download-status");e.classList.add("download-status-active")},v=()=>{let e=document.getElementById("download-status");e.classList.remove("download-status-active")},u=()=>{let t=document.getElementById("filename").value,n=document.createElement("a"),l=e.toDataURL({format:"jpeg",multiplier:4});l.substr(22,l.length);let a=s(l),d=URL.createObjectURL(a);n.download=`${t}.jpg`,n.href=d,n.click(),v()},E=()=>{let t=document.getElementById("filename").value,n=e.toDataURL("image/jpeg",1),l=new jsPDF("p","pt",[e.width,e.height]),a=l.internal.pageSize.getWidth(),d=l.internal.pageSize.getHeight();l.addImage(n,"JPEG",0,0,a,d,void 0,"FAST"),l.save(`${t}.pdf`),v()},h=document.getElementById("save"),w=document.getElementById("modal-bg"),y=document.getElementById("modal-close");function $(t){l="draw",e.isDrawingMode=!0,e.freeDrawingBrush.color=t.target.value,f()}h.addEventListener("click",()=>{w.classList.add("modal-active")}),y.addEventListener("click",()=>{w.classList.remove("modal-active")});let L=document.querySelectorAll(".color");function B(){obj=e.getObjects(),confirm("Do you want to clear the board?")&&e.getObjects().forEach(t=>{e.remove(t)})}function f(t){if(t&&"hide"===t){document.getElementById("colorpallete").classList.remove("show");return}l="draw",e.isDrawingMode=!0,a=!0,document.getElementById("colorpallete").classList.toggle("show")}L.forEach(e=>{e.addEventListener("click",e=>{$(e)})}),document.getElementById("title").addEventListener("click",()=>{var e;if(!confirm("Do you want to clear the board?"))return}),window.onbeforeunload=function(){return"you can not refresh the page"},document.getElementById("draw").addEventListener("click",f),document.getElementById("clear").addEventListener("click",B),document.getElementById("undo").addEventListener("click",()=>{e.undo()}),document.getElementById("redo").addEventListener("click",()=>{e.redo()}),document.addEventListener("keyup",({keyCode:t,ctrlKey:n}=event)=>{n&&(90===t&&e.undo(),89===t&&e.redo())}),document.getElementById("erase").addEventListener("click",()=>{l="erase",e.hoverCursor="pointer",e.isDrawingMode=!1}),document.getElementById("select").addEventListener("click",()=>{l="select",e.isDrawingMode=!1}),e.on("mouse:up",function(t){"erase"===l&&e.remove(t.target)}),e.on("mouse:down",()=>{a&&(document.getElementById("colorpallete").classList.remove("show"),a=!1)})});